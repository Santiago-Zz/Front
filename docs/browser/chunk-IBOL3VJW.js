import{V as c,a as o,b as i,k as s}from"./chunk-4YPG6D4H.js";var l=class n{cart=new s([]);subtotal=new s(0);envio=new s(0);cartOpen=new s(!1);cart$=this.cart.asObservable();subtotal$=this.subtotal.asObservable();envio$=this.envio.asObservable();cartOpen$=this.cartOpen.asObservable();constructor(){let t=localStorage.getItem("cart"),e=localStorage.getItem("cartOpen");if(t){let a=JSON.parse(t);this.cart.next(a),this.calculateSubtotal(a)}this.cartOpen.next(e==="true")}toggleCart(t){console.log("Cambio de estado del carrito a:",t),this.cartOpen.next(t),localStorage.setItem("cartOpen",String(t))}saveCart(t){localStorage.setItem("cart",JSON.stringify(t))}getCartItems(){return this.cart.getValue()}addToCart(t){let e=this.getCartItems(),a=e.find(r=>r.products_Id===t.products_Id);if(a)a.quantity+=1;else{let r=i(o({},t),{quantity:1});e.push(r)}this.cart.next(e),this.saveCart(e),this.calculateSubtotal(e)}removeCart(t){let e=this.getCartItems();e.splice(t,1),this.cart.next(e),this.saveCart(e),this.calculateSubtotal(e)}clearCart(){this.cart.next([]),this.saveCart([]),this.subtotal.next(0),this.envio.next(0)}setShippingCost(t){this.envio.next(t)}getSubtotal(){return this.subtotal.getValue()}getShippingCost(){return this.envio.getValue()}calculateSubtotal(t){let e=t.reduce((a,r)=>a+r.price*(r.quantity||1),0);this.subtotal.next(e)}getTotal(){return this.getSubtotal()+this.getShippingCost()}updateQuantity(t,e){let a=this.getCartItems(),r=a.find(u=>u.id===t);r&&(r.quantity=e,this.cart.next(a),this.saveCart(a),this.calculateSubtotal(a))}static \u0275fac=function(e){return new(e||n)};static \u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"})};export{l as a};
